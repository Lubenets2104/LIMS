{% load static custom_filters %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лист измерений (Битум по ГОСТ 33133-2014)</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Modern Theme CSS -->
    <link rel="stylesheet" href="{% static 'css/modern-theme.css' %}">
    <!-- Measurement Sheets CSS -->
    <link rel="stylesheet" href="{% static 'css/measurement-sheets.css' %}">
</head>
<body>
    <div class="measurement-container">
        <!-- Page Header -->
        <div class="measurement-header">
            <h1>
                <i class="bi bi-droplet-fill"></i>
                Лист измерений (Битум {% if sample.mix %}{{ sample.mix.name }}{% else %}БНД 130/120{% endif %} по ГОСТ 33133-2014)
            </h1>
            <p class="measurement-subtitle">
                Образец № {{ sample.sample_number }} | Дата поступления: {{ sample.received_date|date:'d.m.Y' }}
            </p>
        </div>
        
        <!-- Sample Info -->
        <table class="info-table">
            <tr>
                <td><i class="bi bi-hash"></i> Номер:</td>
                <td><input type="text" value="{{ sample.sample_number }}" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-calendar-event"></i> Дата отбора:</td>
                <td><input type="text" value="{{ sample.sampling_date|date:'d.m.Y' }}" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-person-badge"></i> Заказчик:</td>
                <td><input type="text" value="{{ sample.customer }}" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-calendar-check"></i> Дата поступления в лабораторию:</td>
                <td><input type="text" value="{{ sample.received_date|date:'d.m.Y' }}" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-box-seam"></i> Наименование материала:</td>
                <td><input type="text" value="Битум" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-truck"></i> Поставщик материала:</td>
                <td><input type="text" value="{{ sample.supplier }}" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-layers"></i> Наименование смеси:</td>
                <td><input type="text" value="{% if sample.mix %}{{ sample.mix.name }}{% else %}БНД 130/120{% endif %}" readonly></td>
            </tr>
            <tr>
                <td><i class="bi bi-building"></i> Наименование объекта:</td>
                <td><input type="text" value="{{ sample.object_name }}" readonly></td>
            </tr>
        </table>
        
        <form method="post" action="{% url 'sample_test_form' sample.pk %}" id="bitumen-33133-form">
            {% csrf_token %}
            <input type="hidden" name="action" value="save">
            
            <!-- ГЛУБИНА ПРОНИКАНИЯ ИГЛЫ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-arrow-down-circle"></i>
                Глубина проникания иглы при 25°С
                <span onclick="document.getElementById('help-needle').style.display = document.getElementById('help-needle').style.display === 'none' ? 'block' : 'none'" class="help-icon">ℹ</span>
            </h2>
            <div id="help-needle" class="help-text">
                ◉ Нагреть образец в сушильном шкафу до температуры (105 ± 5) °С<br>
                ◉ Перемешивая стеклянной или металлической палочкой довести образец до температуры испытания<br>
                ◉ Расплавленный битум процедить через сито с металлической сеткой<br>
                ◉ Налить в две пенетрационные чашки так, чтобы поверхность битума была не более чем на 5 мм ниже верхнего края<br>
                ◉ Тщательно перемешать до полного удаления пузырьков воздуха<br>
                ◉ Охладить на воздухе при температуре (21 ± 4) °С, защищая образец от пыли. Продолжительность охлаждения — (75 ± 15) мин<br>
                ◉ Поместить в емкость для термостатирования (баню) с температурой 25°С на (75 ± 15) мин
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">Параметр</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Фактическое значение, мм</td>
                        <td><input type="number" step="0.1" name="needle_deep" id="needle_deep" value="{{ test_result.needle_deep|format_float }}"></td>
                    </tr>
                    <tr>
                        <td>Допуск, мм</td>
                        <td>
                            <input type="text" id="needle_deep_range" value="{{ test_result.needle_deep_min|format_float }}-{{ test_result.needle_deep_max|format_float }}" readonly>
                            <input type="hidden" name="needle_deep_min" value="{{ test_result.needle_deep_min|format_float }}">
                            <input type="hidden" name="needle_deep_max" value="{{ test_result.needle_deep_max|format_float }}">
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- ТЕМПЕРАТУРА РАЗМЯГЧЕНИЯ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-thermometer-half"></i>
                Температура размягчения по кольцу и шару
            </h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">Параметр</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Фактическое значение, °С</td>
                        <td><input type="number" step="0.1" name="softening_temperature" id="softening_temperature" value="{{ test_result.softening_temperature|format_float }}"></td>
                    </tr>
                    <tr>
                        <td>Допуск, °С не ниже</td>
                        <td><input type="number" step="0.1" name="softening_temperature_min" id="softening_temperature_min" value="{{ test_result.softening_temperature_min|format_float }}" readonly></td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- РАСТЯЖИМОСТЬ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-arrows-expand"></i>
                Растяжимость при 0°С
            </h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">Параметр</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Фактическое значение, см</td>
                        <td><input type="number" step="0.1" name="extensibility" id="extensibility" value="{{ test_result.extensibility|format_float }}"></td>
                    </tr>
                    <tr>
                        <td>Допуск, см не менее</td>
                        <td>
                            {% if test_result.extensibility_min %}
                                <input type="number" step="0.1" name="extensibility_min" id="extensibility_min" value="{{ test_result.extensibility_min|format_float }}" readonly>
                            {% else %}
                                <input type="text" name="extensibility_min" id="extensibility_min" value="Не определяется" readonly style="text-align: center;">
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- ТЕМПЕРАТУРА ХРУПКОСТИ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-snow2"></i>
                Температура хрупкости
            </h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">Параметр</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Фактическое значение, °С</td>
                        <td><input type="number" step="0.1" name="fragility_temperature" id="fragility_temperature" value="{{ test_result.fragility_temperature|format_float }}"></td>
                    </tr>
                    <tr>
                        <td>Допуск, °С не выше</td>
                        <td><input type="number" step="0.1" name="fragility_temperature_max" id="fragility_temperature_max" value="{{ test_result.fragility_temperature_max|format_float }}" readonly></td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- ТЕМПЕРАТУРА ВСПЫШКИ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-fire"></i>
                Температура вспышки
            </h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">Параметр</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Фактическое значение, °С</td>
                        <td><input type="number" step="0.1" name="flash_temperature" id="flash_temperature" value="{{ test_result.flash_temperature|format_float }}"></td>
                    </tr>
                    <tr>
                        <td>Допуск, °С не ниже</td>
                        <td><input type="number" step="0.1" name="flash_temperature_min" id="flash_temperature_min" value="{{ test_result.flash_temperature_min|format_float }}" readonly></td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- ИЗМЕНЕНИЕ МАССЫ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-hourglass-split"></i>
                Изменение массы образца после старения
            </h2>
            
            <div class="container-results">
                <!-- Контейнер А -->
                <div class="container-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th colspan="2">Для контейнера А</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Масса стеклянного контейнера, г</td>
                                <td><input type="number" step="0.01" name="container_a_weight" id="container_a_weight" value="{{ test_result.container_a_weight|format_float }}"></td>
                            </tr>
                            <tr>
                                <td>Масса контейнера с битумом до старения, г</td>
                                <td><input type="number" step="0.01" name="container_a_bitumen_before" id="container_a_bitumen_before" value="{{ test_result.container_a_bitumen_before|format_float }}"></td>
                            </tr>
                            <tr>
                                <td>Масса контейнера с битумом после старения, г</td>
                                <td><input type="number" step="0.01" name="container_a_bitumen_after" id="container_a_bitumen_after" value="{{ test_result.container_a_bitumen_after|format_float }}"></td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Результат, %</td>
                                <td><input type="number" step="0.01" name="container_a_result" id="container_a_result" value="{{ test_result.container_a_result|format_float }}" readonly></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Контейнер B -->
                <div class="container-table">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th colspan="2">Для контейнера B</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Масса стеклянного контейнера, г</td>
                                <td><input type="number" step="0.01" name="container_b_weight" id="container_b_weight" value="{{ test_result.container_b_weight|format_float }}"></td>
                            </tr>
                            <tr>
                                <td>Масса контейнера с битумом до старения, г</td>
                                <td><input type="number" step="0.01" name="container_b_bitumen_before" id="container_b_bitumen_before" value="{{ test_result.container_b_bitumen_before|format_float }}"></td>
                            </tr>
                            <tr>
                                <td>Масса контейнера с битумом после старения, г</td>
                                <td><input type="number" step="0.01" name="container_b_bitumen_after" id="container_b_bitumen_after" value="{{ test_result.container_b_bitumen_after|format_float }}"></td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Результат, %</td>
                                <td><input type="number" step="0.01" name="container_b_result" id="container_b_result" value="{{ test_result.container_b_result|format_float }}" readonly></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Общий итог -->
            <table class="data-table">
                <tbody>
                    <tr>
                        <td style="width: 50%; font-weight: bold;">Общий итог</td>
                        <td><input type="number" step="0.01" name="weight_change" id="weight_change" value="{{ test_result.weight_change|format_float }}" readonly></td>
                    </tr>
                    <tr>
                        <td style="font-weight: bold;">Допуск, % не более</td>
                        <td><input type="number" step="0.01" name="weight_change_max" id="weight_change_max" value="{{ test_result.weight_change_max|format_float }}" readonly></td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- ИЗМЕНЕНИЕ ТЕМПЕРАТУРЫ РАЗМЯГЧЕНИЯ -->
            <h2 class="measurement-section-title">
                <i class="bi bi-thermometer-sun"></i>
                Изменение температуры размягчения после старения
            </h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 50%;">Параметр</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Фактическое значение, °С</td>
                        <td><input type="number" step="0.1" name="softening_temperature_change" id="softening_temperature_change" value="{{ test_result.softening_temperature_change|format_float }}"></td>
                    </tr>
                    <tr>
                        <td>Допуск, °С не более</td>
                        <td><input type="number" step="0.1" name="softening_temperature_change_max" id="softening_temperature_change_max" value="{{ test_result.softening_temperature_change_max|format_float }}" readonly></td>
                    </tr>
                </tbody>
            </table>
            <div class="section-footer">Испытания провел(а): _____________</div>
            
            <!-- Buttons -->
            <div class="btn-container">
                <button type="submit" class="btn-save">
                    <i class="bi bi-save"></i>
                    Сохранить
                </button>
                <a href="{% url 'sample_list' %}" class="btn-cancel">
                    <i class="bi bi-arrow-left"></i>
                    Вернуться к списку
                </a>
            </div>
        </form>
    </div>
    
    <!-- JavaScript для расчетов -->
    <script src="{% static 'js/bitumen_33133_calculations.js' %}"></script>
</body>
</html>
